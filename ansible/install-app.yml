#
# certservice install playbook
#

- hosts: "{{ target }}"
  serial: 1
  max_fail_percentage: 10
  gather_facts: false
  remote_user: iamcert


  tasks:

  # copy cs properties file
  # change restarts tomcat
  - name: copy properties file
    copy: "src=../cs.properties.{{ cluster_type }}  dest={{ cs_root }}/cs.properties group=iam-dev mode=664"
    notify: restart tomcat

   # update http and https config
    # change restarts apache
  - include: "ansible-tools/tasks/apache_config.yml file=https prod=cs"
  - include: "ansible-tools/tasks/apache_config.yml file=http prod=cs"


  # update the cs.war file
  - name: copy war
    copy: "src=../target/cs.war dest=/data/webapps/cs.war group=iam-dev mode=664"
    notify: restart tomcat

  # run any handlers 
  - meta: flush_handlers

  # handlers mostly standard from iam-ansible

  handlers:
    - include: "ansible-tools/tasks/iam_handlers.yml"



